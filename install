---
---
#!/bin/sh
set -e

url="{{ site.github.tar_url }}"

tmp=$(mktemp --directory)

trap "rm --recursive ${tmp}" EXIT

wget	--quiet \
	--output-document ${tmp}/tarball.tar.gz \
	${url}

tar 	--directory ${tmp} \
	--transform "s:^[^/]*:.:" \
	--extract \
	--gzip \
	--file ${tmp}/tarball.tar.gz

[ -n "${SUDO_USER}" ] && user=${SUDO_USER} || user=$(id --name --user)
[ -n "${SUDO_UID}" ] && uid=${SUDO_UID} || uid=$(id --user)
[ -n "${SUDO_GID}" ] && gid=${SUDO_GID} || gid=$(id --group)
[ $(id -u) = 0 ] && apt update

install	--mode 644 \
	--owner ${uid} \
	--group ${gid} \
	--target-directory ${HOME} \
	${tmp}/.bash_aliases \
	${tmp}/.bashrc \
	${tmp}/.dircolors \
	${tmp}/.gitconfig \
	${tmp}/.profile \
	${tmp}/.sh_aliases \
	${tmp}/.shrc

[ $(id -u) = 0 ] && apt install --assume-yes \
	bash-completion \
	build-essential \
	curl \
	git \
	tree \
	vim
